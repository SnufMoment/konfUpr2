Визуализация графа зависимостей NuGet-пакетов
1. Проект
Проект представляет собой консольное приложение на Python, реализующее функционал анализа зависимостей NuGet-пакетов:
— сбор графа зависимостей (с учётом транзитивности),
— определение порядка загрузки (топологическая сортировка),
— визуализация графа в формате D2 с автоматическим сохранением в SVG.

Программа разрабатывалась поэтапно и на финальном этапе полностью соответствует требованиям:

запрещено использовать внешние менеджеры пакетов и библиотеки для анализа зависимостей,
все данные получаются напрямую из официального NuGet API,
поддерживается как онлайн-режим (работа с реальными пакетами), так и тестовый (с локальным JSON-репозиторием).
Режимы работы программы:
online — анализ реального NuGet-пакета через api.nuget.org.
test — анализ тестового репозитория с пакетами в виде заглавных латинских букв (A, B, C, ...).

2. Структура проекта

dependency-visualizer/
├── main5.py                 # Основной скрипт (все этапы реализации)
├── test-repo.json           # Тестовый репозиторий (для режима test)
├── stage5/                  # Папка с тестами этапа 5
│   ├── test_dag.bat
│   ├── test_cycle.bat
│   ├── test_mixed.bat
│   ├── test_filtered.bat
│   ├── test_logging.bat
│   └── test_all.bat
└── results/                 # (автоматически создаётся при экспорте)
    └── <package>_dependencies.svg  # Визуализация графа зависимостей
    
4. Функции и ключевые элементы
Основные функции
get_nuget_direct_deps() — загрузка прямых зависимостей пакета через .nuspec из v3-flatcontainer.
dfs_build_graph() — рекурсивное построение графа зависимостей с учётом глубины и фильтрации.
topological_sort() — определение порядка установки (обработка циклов).
generate_d2_code() — генерация диаграммы в формате D2.
export_d2_to_image() — автоматическая визуализация и сохранение в .svg.
Параметры запуска
ФЛАГ
ОПИСАНИЕ
--package
Имя анализируемого пакета (обязательный).
--repo
URL репозитория (
https://api.nuget.org/v3/index.json
) или путь к
test-repo.json
(обязательный).
--mode
Режим работы:
online
или
test
(обязательный).
--max-depth
Максимальная глубина анализа зависимостей (обязательный, ≥0).
--filter
Подстрока для фильтрации пакетов (опционально, исключает пакеты, содержащие подстроку).

5. Сборка и запуск
Проект не требует сборки — достаточно интерпретатора Python 3.8+.

Запуск вручную
bash
# 1. Анализ реального пакета (AutoMapper, глубина 2)
python main5.py --package AutoMapper --repo https://api.nuget.org/v3/index.json --mode online --max-depth 2

# 2. Анализ тестового пакета A
python main5.py --package A --repo test-repo.json --mode test --max-depth 3 --filter D
Визуализация
После запуска автоматически создаётся файл <package>_dependencies.svg в той же папке.
Файл можно открыть в любом браузере (Chrome, Edge, Firefox).

5. Тестирование
Для удобства тестирования подготовлены .bat-скрипты (Windows):

Структура тестов

stage5/
├── test_dag.bat          # Тест ациклического графа (пакет A)
├── test_cycle.bat        # Тест циклических зависимостей (F → G → H → F)
├── test_mixed.bat        # Смешанный сценарий (цикл + DAG)
├── test_filtered.bat     # С фильтрацией (исключить пакеты с "D")
├── test_logging.bat      # Реальный пакет Microsoft.Extensions.Logging
└── test_all.bat          # Запуск всех тестов подряд
Пример запуска
bat
stage5\test_all.bat
После выполнения:

Выводится граф зависимостей и порядок установки.
Генерируется SVG-файл с визуализацией.
6. Примеры работы
6.1. Граф зависимостей (пакет AutoMapper)

Dependency graph:
  AutoMapper -> ['Microsoft.CSharp', 'System.Reflection.Emit']
  Microsoft.CSharp -> ['NETStandard.Library', 'System.Dynamic.Runtime', ...]
  ...
6.2. Порядок загрузки
Installation (load) order:
  1. System.Runtime
  2. System.IO
  3. System.Reflection.Primitives
  4. System.Reflection
  ...
  13. AutoMapper
6.3. Визуализация
После запуска создаётся файл:
AutoMapper_dependencies.svg

Файл содержит диаграмму вида:

d2
// Dependency graph in D2 format
direction: right
"AutoMapper"
"Microsoft.CSharp"
"AutoMapper" -> "Microsoft.CSharp"
"System.Reflection.Emit"
"AutoMapper" -> "System.Reflection.Emit"
...
SVG-файл открывается в браузере и отображает направленный граф зависимостей.

7. Вывод
Проект реализует полный цикл анализа NuGet-зависимостей:

получение данных напрямую из официального API (.nuspec),
построение графа с учётом глубины, фильтрации и циклов,
топологическая сортировка для определения порядка установки,
автоматическая визуализация в векторном формате (SVG).
Все функции протестированы на реальных и тестовых пакетах, соответствуют требованиям задания и не используют запрещённые инструменты.
